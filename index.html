<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Taxonomy Builder (OWL) ‚Äî A ‚Üí B ‚Üí (folhas C) + Layouts</title>
  
  <!-- D3 -->
  <script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
  
  <!-- rdflib.js (l√™ OWL em RDF/XML no browser) -->
  <script src="https://cdn.jsdelivr.net/npm/rdflib@2.2.37/dist/rdflib.min.js"></script>

  <style>
    :root{
      --bg:#ffffff; --panel:#f1f5f9; --text:#0f172a; --muted:#475569; --line:#e2e8f0;
      --accent:#2563eb; --accent2:#1e40af; --warn:#b45309; --danger:#b91c1c; --ok:#166534;
      --shadow: 0 8px 24px rgba(0,0,0,.08);
    }
    [data-theme="dark"]{
      --bg:#000000; --panel:#0f172a; --text:#f1f5f9; --muted:#94a3b8; --line:#1e293b;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    html,body{ height:100%; margin:0; background:var(--bg); color:var(--text); font-family: Arial, sans-serif; overflow:hidden; }
    header{
      background:var(--panel); border-bottom:1px solid var(--line);
      padding:10px 16px; display:flex; align-items:center; justify-content:space-between; height:70px; gap:12px;
    }
    .title{ font-weight:900; font-size:14px; letter-spacing:.2px; display:flex; align-items:center; gap:10px; }
    .controls{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
    .btn{
      background:var(--bg); border:1px solid var(--line); color:var(--text);
      padding:8px 12px; border-radius:10px; cursor:pointer; font-size:11px; font-weight:900; text-transform:uppercase;
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn.primary{ background:var(--accent); color:#fff; border-color:transparent; }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }
    .pill{
      font-size:11px; font-weight:900; padding:6px 10px; border-radius:999px; border:1px solid var(--line);
      color:var(--muted); background:rgba(37,99,235,.06);
    }

    #wrap{ display:flex; height:calc(100% - 70px); }
    .sidebar{
      width:480px; min-width:390px; background:var(--panel); border-right:1px solid var(--line);
      overflow-y:auto; padding:16px; font-size:13px; z-index:10;
    }
    .canvas-area{ flex:1; position:relative; background:var(--bg); overflow:hidden; }
    svg{ width:100%; height:100%; }

    .guide-step{
      background: rgba(37, 99, 235, 0.10);
      border-left:4px solid var(--accent);
      padding:10px; margin-bottom:12px; border-radius:8px;
      color:var(--text);
    }
    .section{ margin-top:14px; padding-top:12px; border-top:1px solid var(--line); }
    h3{ margin:8px 0; font-size:12px; letter-spacing:.5px; color:var(--muted); text-transform:uppercase; }
    .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .field{ width:100%; display:flex; flex-direction:column; gap:6px; margin:8px 0; }
    select, input[type="text"], input[type="range"]{
      width:100%; padding:10px 10px; border-radius:10px; border:1px solid var(--line);
      background:var(--bg); color:var(--text); outline:none;
    }
    input[type="range"]{ padding:6px 10px; }
    label.chk{ display:flex; align-items:center; gap:8px; margin:6px 0; color:var(--text); }
    .small{ font-size:12px; color:var(--muted); line-height:1.3; }
    .status{
      margin-top:10px; padding:10px; border-radius:10px; border:1px solid var(--line);
      background: rgba(2,132,199,.06);
      color:var(--text);
    }
    .status.ok{ background: rgba(22,101,52,.10); border-color: rgba(22,101,52,.35); }
    .status.warn{ background: rgba(180,83,9,.10); border-color: rgba(180,83,9,.35); }
    .status.danger{ background: rgba(185,28,28,.10); border-color: rgba(185,28,28,.35); }

    .branchbox, .leafbox{
      border:1px solid var(--line); border-radius:10px; background:var(--bg);
      padding:10px; max-height:210px; overflow:auto;
    }
    .branchbox .count, .leafbox .count{ font-size:12px; color:var(--muted); margin-bottom:8px; }
    .leafbox label{ display:flex; align-items:flex-start; gap:8px; margin:6px 0; }
    .leafbox input{ margin-top:2px; }

    /* D3 */
    .link{ fill:none; stroke:#94a3b8; stroke-width:1.5px; opacity:.65; }
    [data-theme="dark"] .link{ stroke:#64748b; opacity:.7; }

    .node rect{
      stroke-width:1.5px; rx:10; ry:10;
      filter: drop-shadow(0 2px 5px rgba(0,0,0,.10));
    }
    [data-theme="dark"] .node rect{
      filter: drop-shadow(0 4px 10px rgba(0,0,0,.35));
    }
    .node text{
      font-family: Arial, sans-serif; font-weight:900; pointer-events:none;
      font-size:12px;
    }

    .tooltip{
      position:fixed; display:none; z-index:1000; max-width:520px;
      background:var(--panel); color:var(--text);
      border:1px solid var(--line); border-radius:10px; padding:10px;
      box-shadow:var(--shadow);
      font-size:12px; line-height:1.25;
    }
    .tooltip .t-title{ font-weight:900; margin-bottom:6px; }
    .tooltip .kv{ display:grid; grid-template-columns: 160px 1fr; gap:6px 10px; }
    .tooltip .k{ color:var(--muted); font-weight:900; }
    .tooltip .v{ color:var(--text); word-break:break-word; }
    .hint{ color:var(--muted); font-size:12px; margin-top:6px; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:11px; }
  </style>
</head>

<body data-theme="light">
<header>
  <div class="controls">
    <label class="btn primary" style="cursor:pointer;">
      ü¶â Carregar OWL
      <input type="file" id="fileInput" accept=".owl,.rdf,.xml" style="display:none">
    </label>

    <select id="themeSelect" class="btn" style="text-transform:uppercase; font-weight:900;">
      <option value="light">Modo claro</option>
      <option value="dark">Modo escuro</option>
    </select>

    <span class="pill" id="statsPill">Nenhum arquivo carregado</span>
  </div>

  <div class="title">
    Visualiza√ß√£o OWL: <span class="pill">Top-down</span> <span class="pill">Horizontal</span> <span class="pill">Radial</span>
  </div>

  <div class="controls">
    <button class="btn" id="btnRelayout" disabled>üîÑ Reorganizar</button>
    <button class="btn" id="btnExportA4" disabled>üñºÔ∏è Exportar A4 PNG (300dpi)</button>
    <button class="btn primary" id="btnExportPng" disabled>üíæ Salvar PNG (Auto-fit)</button>
  </div>
</header>

<div id="wrap">
  <div class="sidebar">
    <div class="guide-step">
      <b>Regra fixa:</b> a figura sempre come√ßa em <b>A</b>. O sistema cria a liga√ß√£o <b>A ‚Üí B</b>.
      Depois, <b>B</b> desce por <span class="mono">rdfs:subClassOf</span> at√© as folhas <b>C</b> (uni√£o de caminhos).
    </div>

    <div class="section">
      <h3>Layout da Ontologia</h3>
      <div class="field">
        <select id="layoutSelect">
          <option value="topdown">Top-down (vertical)</option>
          <option value="horizontal">Horizontal (esquerda ‚Üí direita)</option>
          <option value="radial">Radial (topo ‚Üí fora)</option>
        </select>
        <div class="small">Top-down √© o mais "artigo/A4". Radial √© √≥timo para explorar estruturas grandes.</div>
      </div>

      <div class="field">
        <h3>Espa√ßamento</h3>
        <div class="small">Ajuste fino do espa√ßamento entre n√≥s (afeta todos os layouts).</div>
        <input id="spacingRange" type="range" min="0.7" max="2.2" step="0.05" value="1.15" />
        <div class="small">Valor atual: <span id="spacingLabel">1.15</span></div>
      </div>
    </div>

    <div class="section">
      <h3>Buscar</h3>
      <input type="text" id="filterInput" placeholder="Filtrar A, B, folhas e destaques‚Ä¶" />
      <div class="hint">Busca sem acentos e por "cont√©m".</div>
    </div>

    <div class="section">
      <h3>A ‚Äî ponto inicial (obrigat√≥rio)</h3>
      <select id="startSelect"></select>
      <div class="small"><b>A</b> sempre aparece no topo/centro do diagrama.</div>

      <h3 style="margin-top:12px;">B ‚Äî raiz (somente superclasse)</h3>
      <select id="rootSelect"></select>
      <div class="small"><b>B</b> precisa ter subclasses (filhos).</div>
    </div>

    <div class="section">
      <h3>Destaque por sub√°rvore (filhos diretos de B)</h3>
      <div class="small">Marque quais ramos sob <b>B</b> devem ficar em azul.</div>
      <div class="row">
        <button class="btn" id="btnBranchAll" disabled>Marcar tudo</button>
        <button class="btn" id="btnBranchNone" disabled>Desmarcar</button>
      </div>
      <div class="branchbox" id="branchBox">
        <div class="count small">Carregue um OWL‚Ä¶</div>
      </div>
    </div>

    <div class="section">
      <h3>C ‚Äî folhas limite (opcional, m√∫ltiplas)</h3>
      <div class="small">Se n√£o selecionar folhas, mostramos toda a √°rvore de <b>B</b>. Se selecionar, mostramos a uni√£o dos caminhos <b>B ‚Üí C</b>.</div>
      <div class="row">
        <button class="btn" id="btnSelectAllLeaves" disabled>Selecionar tudo</button>
        <button class="btn" id="btnClearLeaves" disabled>Limpar</button>
      </div>
      <div class="leafbox" id="leafBox">
        <div class="count small">Escolha B para listar folhas‚Ä¶</div>
      </div>
    </div>

    <div class="section">
      <div class="row">
        <label class="chk"><input type="checkbox" id="chkDrag" /> Permitir arrastar n√≥s</label>
        <label class="chk"><input type="checkbox" id="chkShowOnlyHighlighted" /> Mostrar s√≥ n√≥s destacados</label>
      </div>

      <button class="btn primary" id="btnGenerate" style="width:100%; padding:14px;" disabled>Gerar ontologia</button>

      <div id="statusBox" class="status" style="margin-top:12px;">
        Carregue um OWL para come√ßar.
      </div>
    </div>
  </div>

  <div class="canvas-area">
    <svg id="svg"></svg>
    <div class="tooltip" id="tooltip"></div>
  </div>
</div>

<script>
/* =========================
   CONFIG (constantes centralizadas)
========================= */
const CONFIG = {
  TARGET_W: 300, PAD_X: 14, PAD_Y: 10, LINE_H: 14,
  NODE_DX: 360, NODE_DY: 160, AUTOFIT_MARGIN: 60,
  MAX_TOOLTIP_PARENTS: 6, MAX_TOOLTIP_CHILDREN: 8, MAX_TOOLTIP_PROPS: 10,
  FILTER_DEBOUNCE_MS: 200,
  RDF: "http://www.w3.org/1999/02/22-rdf-syntax-ns#",
  RDFS: "http://www.w3.org/2000/01/rdf-schema#",
  OWL: "http://www.w3.org/2002/07/owl#"
};

/* =========================
   OwlViz - Namespace principal (refatorado)
========================= */
class OwlViz {
  constructor() {
    this.owlData = null;
    this.uiState = {
      startA: "", rootB: "", selectedLeaves: [], activeBranches: new Set(),
      layout: "topdown", spacing: 1.15, dragEnabled: false, showOnlyHighlighted: false, filterQuery: ""
    };
    this.cache = { parentPtr: null, nodeBranches: null, objPropsByDomain: new Map(), objPropsByRange: new Map() };
    
    this.svg = d3.select("#svg");
    this.gMain = this.svg.append("g");
    this.tooltip = document.getElementById("tooltip");
    this.zoom = d3.zoom().scaleExtent([0.08, 4]).on("zoom", (e) => this.gMain.attr("transform", e.transform));
    this.svg.call(this.zoom);
    
    this.initUI();
    this.bindEvents();
  }

  // =========================
  // Helpers est√°ticos
  // =========================
  static stripAccents(s) { return (s || "").normalize("NFD").replace(/[\u0300-\u036f]/g, ""); }
  static normKey(s) { return this.stripAccents(String(s || "").trim().toLowerCase()).replace(/\s+/g, " "); }
  static escapeHtml(str) {
    return String(str ?? "").replace(/[&<>"']/g, m => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#039;" }[m]));
  }
  static localName(iri) {
    const s = String(iri || ""); const hash = s.lastIndexOf("#"); const slash = s.lastIndexOf("/");
    return Math.max(hash, slash) >= 0 ? s.slice(Math.max(hash, slash) + 1) : s;
  }
  static wrapSvgText(textSel, text, maxWidth, lineHeight) {
    const words = String(text).split(/\s+/g); let line = []; let lineNumber = 0;
    textSel.text(null); let tspan = textSel.append("tspan").attr("x", 0).attr("dy", "0em");
    for (const w of words) {
      line.push(w); tspan.text(line.join(" "));
      if (tspan.node().getComputedTextLength() > maxWidth && line.length > 1) {
        line.pop(); tspan.text(line.join(" ")); line = [w]; lineNumber++;
        tspan = textSel.append("tspan").attr("x", 0).attr("dy", "1.15em").text(w);
      }
    }
    const tspans = textSel.selectAll("tspan").nodes(); const lines = tspans.length || 1;
    const offset = -((lines - 1) * (lineHeight / 2)) / lineHeight;
    if (tspans[0]) tspans[0].setAttribute("dy", `${offset}em`);
  }

  // =========================
  // UI & Status
  // =========================
  setStatus(msg, type = "") {
    const el = document.getElementById("statusBox");
    el.className = `status${type ? ` ${type}` : ""}`; el.innerHTML = msg;
  }
  setStatsPill(text) { document.getElementById("statsPill").textContent = text; }
  setControlsEnabled(enabled) {
    ["btnGenerate", "btnRelayout", "btnExportPng", "btnExportA4", "btnSelectAllLeaves", 
     "btnClearLeaves", "btnBranchAll", "btnBranchNone"].forEach(id => {
      document.getElementById(id).disabled = !enabled;
    });
  }
  formatStatusSummary(aLabel, bLabel, selectedLeaves, layout) {
    const cInfo = selectedLeaves.length 
      ? `Folhas C: <b>${selectedLeaves.length}</b> (uni√£o dos caminhos B‚ÜíC)`
      : `Folhas C: <b>nenhuma</b> (√°rvore completa de B)`;
    const modeLabel = layout === "topdown" ? "Top-down" : layout === "horizontal" ? "Horizontal" : "Radial";
    return `<b>Gerado.</b> Layout: <b>${modeLabel}</b> ‚Ä¢ A: <b>${OwlViz.escapeHtml(aLabel)}</b> ‚Üí B: <b>${OwlViz.escapeHtml(bLabel)}</b> ‚Ä¢ ${cInfo}`;
  }

  // =========================
  // Carregar OWL (com pr√©-indexa√ß√£o)
  // =========================
  async loadOwl(file) {
    try {
      this.setControlsEnabled(false); this.setStatsPill("Carregando‚Ä¶"); this.setStatus("Lendo OWL‚Ä¶", "");
      const text = await file.text(); const $rdf = window.$rdf; const store = $rdf.graph();
      const baseIRI = window.location.href || "urn:local:ont";
      $rdf.parse(text, store, baseIRI, "application/rdf+xml");

      if (!text.includes("<rdf:RDF")) throw new Error("Arquivo n√£o parece RDF/XML (sem <rdf:RDF>).");

      const RDF = $rdf.Namespace(CONFIG.RDF); const RDFS = $rdf.Namespace(CONFIG.RDFS); const OWL = $rdf.Namespace(CONFIG.OWL);
      const classTerms = [...store.each(undefined, RDF("type"), OWL("Class")), ...store.each(undefined, RDF("type"), RDFS("Class"))];
      const classes = new Set(classTerms.map(t => t.value));
      if (classes.size === 0) throw new Error("N√£o encontrei owl:Class / rdfs:Class.");

      const nodes = new Map(); const labelToIris = new Map();
      const getLiteral = (subject, predicate) => store.any($rdf.sym(subject), predicate, undefined)?.value || "";
      
      for (const iri of classes) {
        const label = getLiteral(iri, RDFS("label")) || OwlViz.localName(iri);
        const comment = getLiteral(iri, RDFS("comment"));
        const ns = iri.includes("#") ? iri.slice(0, iri.lastIndexOf("#") + 1) : iri.slice(0, iri.lastIndexOf("/") + 1);
        nodes.set(iri, { iri, label, comment, ns });
        const key = OwlViz.normKey(label);
        if (key && !labelToIris.has(key)) labelToIris.set(key, new Set()).get(key).add(iri);
      }

      const childrenMap = new Map(); const parentsMap = new Map();
      const addEdge = (parentIri, childIri) => {
        if (!childrenMap.has(parentIri)) childrenMap.set(parentIri, new Set());
        childrenMap.get(parentIri).add(childIri);
        if (!parentsMap.has(childIri)) parentsMap.set(childIri, new Set());
        parentsMap.get(childIri).add(parentIri);
      };
      
      store.statementsMatching(undefined, RDFS("subClassOf"), undefined)
        .forEach(st => {
          const child = st.subject?.value; const parent = st.object?.value;
          if (child && parent && classes.has(child) && classes.has(parent)) addEdge(parent, child);
        });

      const objProps = []; const objPropsByDomain = new Map(); const objPropsByRange = new Map();
      store.each(undefined, RDF("type"), OWL("ObjectProperty")).forEach(p => {
        const iri = p.value; const label = getLiteral(iri, RDFS("label")) || OwlViz.localName(iri);
        const domTerms = store.each(p, RDFS("domain"), undefined); const rngTerms = store.each(p, RDFS("range"), undefined);
        const domain = new Set(domTerms.map(t => t.value).filter(v => classes.has(v)));
        const range = new Set(rngTerms.map(t => t.value).filter(v => classes.has(v)));
        objProps.push({ iri, label, domain, range });
        domain.forEach(iri => { if (!objPropsByDomain.has(iri)) objPropsByDomain.set(iri, []); objPropsByDomain.get(iri).push(label); });
        range.forEach(iri => { if (!objPropsByRange.has(iri)) objPropsByRange.set(iri, []); objPropsByRange.get(iri).push(label); });
      });
      objPropsByDomain.forEach(list => list.sort((a, b) => a.localeCompare(b, "pt-BR")));
      objPropsByRange.forEach(list => list.sort((a, b) => a.localeCompare(b, "pt-BR")));

      this.owlData = { nodes, childrenMap, parentsMap, objProps, labelToIris };
      this.cache.objPropsByDomain = objPropsByDomain; this.cache.objPropsByRange = objPropsByRange;

      const edgesCount = Array.from(childrenMap.values()).reduce((a, s) => a + s.size, 0);
      this.setStatsPill(`${nodes.size} classes ‚Ä¢ ${edgesCount} subClassOf ‚Ä¢ ${objProps.length} object properties`);
      this.populateUI(); this.setControlsEnabled(true);
      this.setStatus("<b>OWL carregado.</b> Selecione <b>A</b>, <b>B</b> e (opcional) folhas <b>C</b>.", "ok");
    } catch (err) {
      console.error(err); this.owlData = null; this.setControlsEnabled(false);
      this.setStatsPill("Falha ao carregar"); this.setStatus(`<b>Erro:</b> ${OwlViz.escapeHtml(err.message || String(err))}`, "danger");
    }
  }

  // =========================
  // Cache e hierarquia
  // =========================
  updateBcache(rootBIri) {
    if (!this.owlData?.nodes.has(rootBIri)) return;
    this.cache.parentPtr = this.buildParentPtr(rootBIri);
    this.cache.nodeBranches = new Map();
    for (const [childIri] of this.owlData.childrenMap) {
      if (this.cache.parentPtr.has(childIri)) this.cache.nodeBranches.set(childIri, this.computeBranchOfNode(rootBIri, childIri));
    }
  }

  buildParentPtr(rootBIri) {
    const parentPtr = new Map(); const q = [rootBIri]; parentPtr.set(rootBIri, null);
    while (q.length) {
      const cur = q.shift(); const kids = this.owlData.childrenMap.get(cur);
      if (!kids) continue; for (const k of kids) {
        if (!parentPtr.has(k)) { parentPtr.set(k, cur); q.push(k); }
      }
    }
    return parentPtr;
  }

  computeBranchOfNode(rootBIri, nodeIri) {
    if (nodeIri === rootBIri) return rootBIri;
    let cur = nodeIri; while (cur !== null) {
      const p = this.cache.parentPtr.get(cur); if (p === rootBIri) return cur; cur = p;
    }
    return null;
  }

  pathBtoX(rootBIri, xIri) {
    if (!this.cache.parentPtr?.has(xIri)) return null;
    const path = []; let cur = xIri;
    while (cur !== null) { path.push(cur); if (cur === rootBIri) break; cur = this.cache.parentPtr.get(cur); }
    return path[path.length - 1] === rootBIri ? path.reverse() : null;
  }

  buildVisualHierarchy() {
    if (!this.owlData || !this.uiState.startA || !this.uiState.rootB) return null;
    const startA = this.owlData.nodes.get(this.uiState.startA);
    if (!startA) return null;
    
    const subtree = this.buildSubtreeFromB(this.uiState.rootB, this.uiState.selectedLeaves, this.uiState.activeBranches, this.uiState.showOnlyHighlighted);
    if (subtree.error) { this.setStatus(subtree.error, "warn"); return null; }
    
    return d3.hierarchy({
      ...startA, highlighted: true, __isA: true,
      children: [{ ...subtree.rootObj, highlighted: true, __isB: true }]
    });
  }

  buildSubtreeFromB(rootBIri, selectedLeaves, activeBranches, showOnlyHighlighted) {
    this.updateBcache(rootBIri);
    const parentPtr = this.cache.parentPtr;
    let allowed = null;
    
    if (selectedLeaves.length) {
      allowed = new Set([rootBIri]);
      const invalidLeaves = [];
      for (const leaf of selectedLeaves) {
        const path = this.pathBtoX(rootBIri, leaf);
        if (!path) invalidLeaves.push(this.owlData.nodes.get(leaf)?.label || OwlViz.localName(leaf));
        else path.forEach(n => allowed.add(n));
      }
      if (invalidLeaves.length) return { error: `Folhas inalcan√ß√°veis: ${invalidLeaves.join(", ")}` };
    }

    function buildNode(name, visited) {
      if (visited.has(name)) return null; visited.add(name);
      if (allowed && !allowed.has(name)) return null;
      
      const n = this.owlData.nodes.get(name) || { iri: name, label: OwlViz.localName(name), comment: "", ns: "" };
      const highlighted = name === rootBIri || this.cache.nodeBranches.get(name) && activeBranches.has(this.cache.nodeBranches.get(name));
      
      if (showOnlyHighlighted && !highlighted && !(allowed && allowed.has(name))) return null;
      
      const kids = this.owlData.childrenMap.get(name); let children = [];
      if (kids) for (const c of kids) {
        if (allowed && !allowed.has(c)) continue;
        const built = buildNode.call(this, c, new Set(visited));
        if (built) children.push(built);
      }
      children.sort((a, b) => a.label.localeCompare(b.label, "pt-BR"));
      return { ...n, highlighted, children };
    }

    const rootObj = buildNode.call(this, rootBIri, new Set());
    return rootObj ? { rootObj } : { error: "N√£o foi poss√≠vel construir a √°rvore." };
  }

  // =========================
  // UI Population (resumido)
  // =========================
  iriListSorted() {
    return Array.from(this.owlData.nodes.values())
      .sort((a, b) => a.label.localeCompare(b.label, "pt-BR")).map(n => n.iri);
  }

  populateUI() {
    this.updateStartOptions(); this.updateRootOptions();
    this.updateBranchOptions(); this.updateLeafOptions();
    this.applyFilterToUI(this.uiState.filterQuery);
  }

  updateStartOptions() {
    const sel = d3.select("#startSelect").html("");
    this.iriListSorted().forEach(iri => sel.append("option").attr("value", iri).text(this.owlData.nodes.get(iri).label));
  }

  updateRootOptions() {
    const sel = d3.select("#rootSelect").html("");
    const superClasses = Array.from(this.owlData.childrenMap.keys())
      .filter(iri => this.owlData.nodes.has(iri))
      .sort((a, b) => this.owlData.nodes.get(a).label.localeCompare(this.owlData.nodes.get(b).label, "pt-BR"));
    
    if (superClasses.length === 0) {
      sel
